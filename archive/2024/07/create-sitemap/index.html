<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>
    サイトマップを自動で作成する The Infinity's Article
  </title>
  <link rel="stylesheet" href="/InfinitySpirit/layout/style.css" />
  <script defer src="/InfinitySpirit/layout/script.js"></script>
  <script defer src="/app/audio-player/insert.js"></script>
  <link rel="stylesheet" href="/layout/style.css" />
  <script defer src="/layout/script.js"></script>
  <meta name="description" content="The Infinity's articles " />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="サイトマップを自動で作成する" />
  <meta property="og:description" content="Welcome to The Infinitys's Article!" />
  <meta property="og:image" content="https://the-infinitys.f5.si/article-2024/07/create-sitemap/thumbnail.svg" />
  <!--icon-->
  <link rel="apple-touch-icon" type="image/png" href="/image/favicon/apple-touch-icon-256x256.png" />
  <link rel="icon" type="image/png" href="/image/favicon/icon-256x256.png" />
  <!-- for Google -->
  <script defer src="https://www.googletagmanager.com/gtag/js?id=G-6F5Z0EB6JE"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() {
      dataLayer.push(arguments);
    }
    gtag("js", new Date());
    gtag("config", "G-6F5Z0EB6JE");
  </script>
  <script defer src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2045274771035552"
    crossorigin="anonymous"></script>
</head>

<body>
  <div class="article-body">
    <div class="article-title">
      サイトマップを自動で作成する
      <br />
      <svg class="clock-watch" version="1.1" xmlns="http://www.w3.org/2000/svg"
        xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 100 100" stroke="#888" fill="none" stroke-width="5"
        stroke-linecap="round">
        <g class="Infinity-clock_frame">
          <circle cx="50" cy="50" r="40" />
          <circle cx="50" cy="50" r="30" stroke-opacity="0.5" />
          <ellipse cx="37.5" cy="50" rx="12.5" ry="10" stroke-width="2" stroke-opacity="0.5" />
          <ellipse cx="62.5" cy="50" rx="12.5" ry="10" stroke-width="2" stroke-opacity="0.5" />
          <animate attributeName="stroke" dur="5s" repeatCount="indefinite"
            values="#ff0000;#ffff00;#00ff00;#00ffff;#0000ff;#ff00ff;#ff0000">
        </g>
        <g class="Infinity-clock_hands">
          <path d="M50 50,L50 20 Z" />
          <path d="M50 50,L60 60 Z" />
        </g>
      </svg>
      <InfinitySpiritDate>2024/07/16</InfinitySpiritDate>
      <br />
    </div>
    <div class="article-content">
      <InfinitySpiritContent>
          <h1 id="_1">サイトマップを自動で作成する</h1>
          <h2 id="_2">ブログ記事の問題</h2>
          <p>どうも！ The Infinity&rsquo;sです！最近ドメイン<a href="the-infinitys.f5.si">the-infinitys.f5.si</a>をGoogleに登録してから、いくつかサイトは登録されたのですが&hellip;</p>
          <p><strong>ブログ記事が登録されない</strong><br />
          と言う問題を迎えています。<br />
          そう言うことで早速自動的に記事をインデックスに登録してもらうために、<br />
          sitemap.xmlを用意したいと思います。それも自動です。</p>
          <h2 id="_3">自動スクリプト</h2>
<div class="codehilite" style="background: #272822"><pre style="line-height: 125%;"><span></span><code><span style="color: #ff4689">import</span> <span style="color: #f8f8f2">sys</span>
<span style="color: #ff4689">import</span> <span style="color: #f8f8f2">os</span>

<span style="color: #f8f8f2">repos</span> <span style="color: #ff4689">=</span> <span style="color: #f8f8f2">[</span><span style="color: #e6db74">&quot;article-2024&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;InfinitySpirit&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;Scratch&quot;</span><span style="color: #f8f8f2">]</span>
<span style="color: #66d9ef">for</span> <span style="color: #f8f8f2">repo</span> <span style="color: #ff4689">in</span> <span style="color: #f8f8f2">repos:</span>
    <span style="color: #f8f8f2">os</span><span style="color: #ff4689">.</span><span style="color: #f8f8f2">system(</span><span style="color: #e6db74">&quot;git clone https://github.com/The-Infinitys/&quot;</span> <span style="color: #ff4689">+</span> <span style="color: #f8f8f2">repo</span> <span style="color: #ff4689">+</span> <span style="color: #e6db74">&quot;.git&quot;</span><span style="color: #f8f8f2">)</span>


<span style="color: #66d9ef">def</span> <span style="color: #a6e22e">folders</span><span style="color: #f8f8f2">(dir_path)</span> <span style="color: #ff4689">-&gt;</span> <span style="color: #f8f8f2">list:</span>
    <span style="color: #f8f8f2">result</span> <span style="color: #ff4689">=</span> <span style="color: #f8f8f2">[</span>
        <span style="color: #f8f8f2">f</span> <span style="color: #66d9ef">for</span> <span style="color: #f8f8f2">f</span> <span style="color: #ff4689">in</span> <span style="color: #f8f8f2">os</span><span style="color: #ff4689">.</span><span style="color: #f8f8f2">listdir(dir_path)</span> <span style="color: #66d9ef">if</span> <span style="color: #f8f8f2">os</span><span style="color: #ff4689">.</span><span style="color: #f8f8f2">path</span><span style="color: #ff4689">.</span><span style="color: #f8f8f2">isdir(os</span><span style="color: #ff4689">.</span><span style="color: #f8f8f2">path</span><span style="color: #ff4689">.</span><span style="color: #f8f8f2">join(dir_path,</span> <span style="color: #f8f8f2">f))</span>
    <span style="color: #f8f8f2">]</span>
    <span style="color: #66d9ef">return</span> <span style="color: #f8f8f2">result</span>


<span style="color: #66d9ef">def</span> <span style="color: #a6e22e">files</span><span style="color: #f8f8f2">(dir_path)</span> <span style="color: #ff4689">-&gt;</span> <span style="color: #f8f8f2">list:</span>
    <span style="color: #f8f8f2">result</span> <span style="color: #ff4689">=</span> <span style="color: #f8f8f2">[</span>
        <span style="color: #f8f8f2">f</span> <span style="color: #66d9ef">for</span> <span style="color: #f8f8f2">f</span> <span style="color: #ff4689">in</span> <span style="color: #f8f8f2">os</span><span style="color: #ff4689">.</span><span style="color: #f8f8f2">listdir(dir_path)</span> <span style="color: #66d9ef">if</span> <span style="color: #f8f8f2">os</span><span style="color: #ff4689">.</span><span style="color: #f8f8f2">path</span><span style="color: #ff4689">.</span><span style="color: #f8f8f2">isfile(os</span><span style="color: #ff4689">.</span><span style="color: #f8f8f2">path</span><span style="color: #ff4689">.</span><span style="color: #f8f8f2">join(dir_path,</span> <span style="color: #f8f8f2">f))</span>
    <span style="color: #f8f8f2">]</span>
    <span style="color: #66d9ef">return</span> <span style="color: #f8f8f2">result</span>


<span style="color: #66d9ef">def</span> <span style="color: #a6e22e">all_files</span><span style="color: #f8f8f2">(dir_path,</span> <span style="color: #f8f8f2">hide_file</span><span style="color: #ff4689">=</span><span style="color: #66d9ef">False</span><span style="color: #f8f8f2">)</span> <span style="color: #ff4689">-&gt;</span> <span style="color: #f8f8f2">list:</span>
    <span style="color: #f8f8f2">result</span> <span style="color: #ff4689">=</span> <span style="color: #f8f8f2">[]</span>
    <span style="color: #66d9ef">for</span> <span style="color: #f8f8f2">file</span> <span style="color: #ff4689">in</span> <span style="color: #f8f8f2">files(dir_path):</span>
        <span style="color: #66d9ef">if</span> <span style="color: #ff4689">not</span> <span style="color: #f8f8f2">file</span><span style="color: #ff4689">.</span><span style="color: #f8f8f2">startswith(</span><span style="color: #e6db74">&quot;.&quot;</span><span style="color: #f8f8f2">)</span> <span style="color: #ff4689">or</span> <span style="color: #f8f8f2">hide_file:</span>
            <span style="color: #f8f8f2">result</span><span style="color: #ff4689">.</span><span style="color: #f8f8f2">append(dir_path</span> <span style="color: #ff4689">+</span> <span style="color: #e6db74">&quot;/&quot;</span> <span style="color: #ff4689">+</span> <span style="color: #f8f8f2">file)</span>
    <span style="color: #66d9ef">for</span> <span style="color: #f8f8f2">folder</span> <span style="color: #ff4689">in</span> <span style="color: #f8f8f2">folders(dir_path):</span>
        <span style="color: #66d9ef">if</span> <span style="color: #ff4689">not</span> <span style="color: #f8f8f2">folder</span><span style="color: #ff4689">.</span><span style="color: #f8f8f2">startswith(</span><span style="color: #e6db74">&quot;.&quot;</span><span style="color: #f8f8f2">)</span> <span style="color: #ff4689">or</span> <span style="color: #f8f8f2">hide_file:</span>
            <span style="color: #66d9ef">for</span> <span style="color: #f8f8f2">all_file</span> <span style="color: #ff4689">in</span> <span style="color: #f8f8f2">all_files(dir_path</span> <span style="color: #ff4689">+</span> <span style="color: #e6db74">&quot;/&quot;</span> <span style="color: #ff4689">+</span> <span style="color: #f8f8f2">folder):</span>
                <span style="color: #f8f8f2">result</span><span style="color: #ff4689">.</span><span style="color: #f8f8f2">append(all_file)</span>
    <span style="color: #66d9ef">return</span> <span style="color: #f8f8f2">result</span>


<span style="color: #66d9ef">def</span> <span style="color: #a6e22e">git_renew</span><span style="color: #f8f8f2">():</span>
    <span style="color: #f8f8f2">os</span><span style="color: #ff4689">.</span><span style="color: #f8f8f2">system(</span><span style="color: #e6db74">&quot;git config user.name github-actions&quot;</span><span style="color: #f8f8f2">)</span>
    <span style="color: #f8f8f2">os</span><span style="color: #ff4689">.</span><span style="color: #f8f8f2">system(</span><span style="color: #e6db74">&quot;git config user.email github-actions@github.com&quot;</span><span style="color: #f8f8f2">)</span>
    <span style="color: #f8f8f2">os</span><span style="color: #ff4689">.</span><span style="color: #f8f8f2">system(</span><span style="color: #e6db74">&quot;git add .&quot;</span><span style="color: #f8f8f2">)</span>
    <span style="color: #f8f8f2">os</span><span style="color: #ff4689">.</span><span style="color: #f8f8f2">system(</span><span style="color: #e6db74">&#39;git commit -m &quot;Create Sitemap&quot;&#39;</span><span style="color: #f8f8f2">)</span>
    <span style="color: #f8f8f2">os</span><span style="color: #ff4689">.</span><span style="color: #f8f8f2">system(</span><span style="color: #e6db74">&quot;git push&quot;</span><span style="color: #f8f8f2">)</span>


<span style="color: #f8f8f2">indexes</span> <span style="color: #ff4689">=</span> <span style="color: #f8f8f2">[]</span>
<span style="color: #66d9ef">for</span> <span style="color: #f8f8f2">file</span> <span style="color: #ff4689">in</span> <span style="color: #f8f8f2">all_files(</span><span style="color: #e6db74">&quot;.&quot;</span><span style="color: #f8f8f2">):</span>
    <span style="color: #66d9ef">if</span> <span style="color: #f8f8f2">file</span><span style="color: #ff4689">.</span><span style="color: #f8f8f2">endswith(</span><span style="color: #e6db74">&quot;.html&quot;</span><span style="color: #f8f8f2">):</span>
        <span style="color: #f8f8f2">indexes</span><span style="color: #ff4689">.</span><span style="color: #f8f8f2">append(</span><span style="color: #e6db74">&quot;https://the-infinitys.f5.si&quot;</span> <span style="color: #ff4689">+</span> <span style="color: #f8f8f2">file[</span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2">:])</span>
<span style="color: #959077"># as txt</span>
<span style="color: #f8f8f2">sitemap_content</span> <span style="color: #ff4689">=</span> <span style="color: #e6db74">&quot;&quot;</span>
<span style="color: #66d9ef">for</span> <span style="color: #f8f8f2">index</span> <span style="color: #ff4689">in</span> <span style="color: #f8f8f2">indexes:</span>
    <span style="color: #f8f8f2">sitemap_content</span> <span style="color: #ff4689">+=</span> <span style="color: #f8f8f2">index</span> <span style="color: #ff4689">+</span> <span style="color: #e6db74">&quot;</span><span style="color: #ae81ff">\n</span><span style="color: #e6db74">&quot;</span>
<span style="color: #f8f8f2">print(</span><span style="color: #e6db74">&quot;SITE MAP&quot;</span><span style="color: #f8f8f2">)</span>
<span style="color: #f8f8f2">print(</span><span style="color: #e6db74">&quot;-&quot;</span> <span style="color: #ff4689">*</span> <span style="color: #ae81ff">40</span><span style="color: #f8f8f2">)</span>
<span style="color: #f8f8f2">print(sitemap_content)</span>
<span style="color: #f8f8f2">print(</span><span style="color: #e6db74">&quot;-&quot;</span> <span style="color: #ff4689">*</span> <span style="color: #ae81ff">40</span><span style="color: #f8f8f2">)</span>
<span style="color: #959077"># as xml</span>
<span style="color: #f8f8f2">sitemap_content</span> <span style="color: #ff4689">=</span> <span style="color: #e6db74">&quot;&quot;&quot;&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span style="color: #e6db74">&lt;urlset xmlns=&quot;http://www.sitemaps.org/schemas/sitemap/0.9&quot;&gt;</span>
<span style="color: #e6db74">&quot;&quot;&quot;</span>
<span style="color: #66d9ef">for</span> <span style="color: #f8f8f2">index</span> <span style="color: #ff4689">in</span> <span style="color: #f8f8f2">indexes:</span>
    <span style="color: #f8f8f2">index</span> <span style="color: #ff4689">=</span> <span style="color: #f8f8f2">(</span>
        <span style="color: #f8f8f2">index</span><span style="color: #ff4689">.</span><span style="color: #f8f8f2">replace(</span><span style="color: #e6db74">&quot;&amp;&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;&amp;amp;&quot;</span><span style="color: #f8f8f2">)</span>
        <span style="color: #ff4689">.</span><span style="color: #f8f8f2">replace(</span><span style="color: #e6db74">&quot;&#39;&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;&amp;apos;&quot;</span><span style="color: #f8f8f2">)</span>
        <span style="color: #ff4689">.</span><span style="color: #f8f8f2">replace(</span><span style="color: #e6db74">&#39;&quot;&#39;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;&amp;quot;&quot;</span><span style="color: #f8f8f2">)</span>
        <span style="color: #ff4689">.</span><span style="color: #f8f8f2">replace(</span><span style="color: #e6db74">&quot;&gt;&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;&amp;gt;&quot;</span><span style="color: #f8f8f2">)</span>
        <span style="color: #ff4689">.</span><span style="color: #f8f8f2">replace(</span><span style="color: #e6db74">&quot;&lt;&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;&amp;lt;&quot;</span><span style="color: #f8f8f2">)</span>
    <span style="color: #f8f8f2">)</span>  <span style="color: #959077"># escaper</span>
    <span style="color: #f8f8f2">sitemap_content</span> <span style="color: #ff4689">+=</span> <span style="color: #ae81ff">4</span> <span style="color: #ff4689">*</span> <span style="color: #e6db74">&quot; &quot;</span> <span style="color: #ff4689">+</span> <span style="color: #e6db74">&quot;&lt;url&gt;</span><span style="color: #ae81ff">\n</span><span style="color: #e6db74">&quot;</span><span style="color: #ff4689">+</span><span style="color: #ae81ff">8</span> <span style="color: #ff4689">*</span> <span style="color: #e6db74">&quot; &quot;</span> <span style="color: #ff4689">+</span> <span style="color: #e6db74">&quot;&lt;loc&gt;&quot;</span> <span style="color: #ff4689">+</span> <span style="color: #f8f8f2">index</span> <span style="color: #ff4689">+</span> <span style="color: #e6db74">&quot;&lt;/loc&gt;</span><span style="color: #ae81ff">\n</span><span style="color: #e6db74">&quot;</span> <span style="color: #ff4689">+</span> <span style="color: #ae81ff">4</span> <span style="color: #ff4689">*</span> <span style="color: #e6db74">&quot; &quot;</span> <span style="color: #ff4689">+</span> <span style="color: #e6db74">&quot;&lt;/url&gt;</span><span style="color: #ae81ff">\n</span><span style="color: #e6db74">&quot;</span>
<span style="color: #f8f8f2">sitemap_content</span> <span style="color: #ff4689">+=</span> <span style="color: #e6db74">&quot;&lt;/urlset&gt;&quot;</span>
<span style="color: #66d9ef">with</span> <span style="color: #f8f8f2">open(</span><span style="color: #e6db74">&quot;./sitemap.xml&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">mode</span><span style="color: #ff4689">=</span><span style="color: #e6db74">&quot;w&quot;</span><span style="color: #f8f8f2">)</span> <span style="color: #66d9ef">as</span> <span style="color: #f8f8f2">f:</span>
    <span style="color: #f8f8f2">f</span><span style="color: #ff4689">.</span><span style="color: #f8f8f2">write(sitemap_content)</span>

<span style="color: #f8f8f2">git_renew()</span>
          </code></pre></div>
          
          <p>仕組みとしては、まず、</p>
          <ol>
          <li>必要なリポジトリを全てクローン</li>
          <li>ファイルを全て探索する。</li>
          <li>拡張子がhtmlで終わるものだけを集める</li>
          <li>URLに変換</li>
          <li>XMLに変換</li>
          <li>保存</li>
          </ol>
          <p>と言ったステップになっています。</p>
          <p>これで楽にインデックス登録ができますね！</p>

          </InfinitySpiritContent>
    </div>
    <div class="article-share" onclick="copyURL()">
      <img src="/InfinitySpirit/layout/image/Infinity-clipboard.svg" alt="" />
      Copy To ClipBoard
    </div>
    <div class="article-share" onclick="shareX()">
      <img src="/InfinitySpirit/layout/image/X-Infinity.svg" alt="" />
      Share On X
    </div>
    <div class="article-index"></div>
    <div class="articles-recommended">
      <button>
        <img src="/InfinitySpirit/layout/image/loading.svg" alt="" />
        <div>
          <h1>THE INFINITYS BELIEVE THE INFINITY</h1>
          <p>date:2024/07/07</p>
        </div>
      </button>
    </div>
  </div>
</body>

</html>
